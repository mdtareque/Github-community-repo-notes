### Creating a client with dispatch mechanism (less dependancy on the proxy classes, i.e. creating soap body ourselves and invoking the service)

To turn on logging, to see what is sent in background, we can enable below JAXB specific switch
System.setProperty("com.sun.xml.ws.transport.http.client.HttpTransportPipe.dump", "true");

### Create client with dispatch and using JAXB

ProxyUsage
More use of proxy classes, less code to write.

CcyConvertClientUsingSAAJ
    package client_testers;
     import java.net.URL;
     import javax.xml.namespace.QName;
    import javax.xml.soap.MessageFactory;
    import javax.xml.soap.SOAPBody;
    import javax.xml.soap.SOAPBodyElement;
    import javax.xml.soap.SOAPConnection;
    import javax.xml.soap.SOAPConnectionFactory;
    import javax.xml.soap.SOAPElement;
    import javax.xml.soap.SOAPMessage;
 
    // Creating soap message, no use of proxy classes done
    public class CcyConvertClientUsingSAAJ {
 
    public static void main(String[] args) throws Exception {
    //        Example 3, day 2 before lunch       
    //        no use of this are not using jaxb
    //        System.setProperty("com.sun.xml.internal.ws.transport.http.client.HttpTransportPipe.dump", "true");
             
        MessageFactory messageFactory = MessageFactory.newInstance();
        SOAPMessage request = messageFactory.createMessage();
        SOAPBody requestBody = request.getSOAPBody();
        QName bodyName = new QName("http://service/", "convert", "cs");
         
        SOAPBodyElement bodyElement = requestBody.addBodyElement(bodyName);
         
        SOAPElement elem = bodyElement.addChildElement("arg0");
        elem.addTextNode("USD");
        elem = bodyElement.addChildElement("arg1");
        elem.addTextNode("INR");
        elem = bodyElement.addChildElement("arg2");
        elem.addTextNode(4.52+"");
         
        // now the code to connect to the service
        URL url = new URL("http://localhost:8080/WS-proj1/CurrencyConverterServiceService");
        SOAPConnectionFactory connectionFactory = SOAPConnectionFactory.newInstance();
        SOAPConnection connection = connectionFactory.createConnection();
         
        SOAPMessage response = connection.call(request, url);
        SOAPBody responseBody = response.getSOAPBody();
        System.out.println(responseBody.getTextContent());
         
        connection.close();
    }
    }


No prefix given

    S:Serverjava.lang.NullPointerException

Document Literal wsdl is generated by default. To generate a RPC style, we can use below annotation

    @WebService
    @SOAPBinding(style=Style.DOCUMENT)
    public class CurrencyConverterService {..}

Then tried some variations to write server side service code.
Parameter Styles  (Bare, Wrapped ) examples. Good to use Wrapped as it's default. Also can use multiple params in Wrapped only. Bare will give error if parameter number is more than 1
Tested by soapui. Seen the difference in the request and response body tags.

ParameterStyle.WRAPPED
    package service;
 
    import javax.jws.WebMethod;
    import javax.jws.WebService;
    import javax.jws.soap.SOAPBinding;
    import javax.jws.soap.SOAPBinding.ParameterStyle;
 
    @WebService(serviceName="HelloService1", targetNamespace="http://www.tareque.com/training/ws/h1")
    //wsdlLocation : to be provided if we use top to down approach, i.e. have written a wsdl first(contract)
    @SOAPBinding(parameterStyle=ParameterStyle.WRAPPED) // default
    public class HelloService1 {
 
    @WebMethod(operationName="greeting")
    public String sayHello(Name name) {
        return "Hello " + name.getLastName() + ", " + name.getFirstName();
    }
    /*
    // we can expose the method with different name
    @WebMethod(operationName="greetingMy")
    // there is exclude option to not expose the method. As by default all public methods are exposed.
    public Details sayHelloMy(Name name) {
        return new Details(name.getFirstName().charAt(0), name.getFirstName());
    }
    */
    public String echo(String str) {
        return str;
    }
    }
    
ParameterStyle.BARE
    package service;
 
    import javax.jws.WebMethod;
    import javax.jws.WebService;
    import javax.jws.soap.SOAPBinding;
    import javax.jws.soap.SOAPBinding.ParameterStyle;
 
    @WebService(serviceName="HelloService2", targetNamespace="http://www.tareque.com/training/ws/h2")
    //wsdlLocation : to be provided if we use top to down approach, i.e. have written a wsdl first(contract)
    @SOAPBinding(parameterStyle=ParameterStyle.BARE)
    public class HelloService2 {
 
    @WebMethod(operationName="greeting")
    public String sayHello(Name name) {
        return "Hello2 " + name.getLastName() + ", " + name.getFirstName();
    }
    /*
    // we can expose the method with different name
    @WebMethod(operationName="greetingMy")
    // there is exclude option to not expose the method. As by default all public methods are exposed.
    public Details sayHelloMy(Name name) {
        return new Details(name.getFirstName().charAt(0), name.getFirstName());
    }
    */
    public String echo(String str) {
        return "2> "+str;
    }
    }    


 

Below exception was resolved, by adding default constructor to the pojo return type class. Tested successfully in soap ui. Even got a 'String index out of bound exception' stack trace, if empty input given.
 Exception when trying to set return type as a class(pojo)

[#|2014-05-13T14:41:01.546+0530|SEVERE|glassfish3.1|javax.enterprise.system.tools.admin.org.glassfish.deployment.admin|_ThreadID=57;_ThreadName=Thread-1;|Exception
 while invoking class com.sun.enterprise.web.WebApplication start method
java.lang.Exception:
 java.lang.IllegalStateException: ContainerBase.addChild: start: 
org.apache.catalina.LifecycleException: java.lang.RuntimeException: 
Servlet web service endpoint '' failure
    at com.sun.enterprise.web.WebApplication.start(WebApplication.java:130)
    at org.glassfish.internal.data.EngineRef.start(EngineRef.java:130)
    at org.glassfish.internal.data.ModuleInfo.start(ModuleInfo.java:269)
    at org.glassfish.internal.data.ApplicationInfo.start(ApplicationInfo.java:286)
    at com.sun.enterprise.v3.server.ApplicationLifecycle.deploy(ApplicationLifecycle.java:461)
    at com.sun.enterprise.v3.server.ApplicationLifecycle.deploy(ApplicationLifecycle.java:240)
    at org.glassfish.deployment.admin.DeployCommand.execute(DeployCommand.java:370)
    at com.sun.enterprise.v3.admin.CommandRunnerImpl$1.execute(CommandRunnerImpl.java:355)
    at com.sun.enterprise.v3.admin.CommandRunnerImpl.doCommand(CommandRunnerImpl.java:370)
    at com.sun.enterprise.v3.admin.CommandRunnerImpl.doCommand(CommandRunnerImpl.java:1067)
    at com.sun.enterprise.v3.admin.CommandRunnerImpl.access$1200(CommandRunnerImpl.java:96)
    at com.sun.enterprise.v3.admin.CommandRunnerImpl$ExecutionContext.execute(CommandRunnerImpl.java:1247)
    at com.sun.enterprise.v3.admin.CommandRunnerImpl$ExecutionContext.execute(CommandRunnerImpl.java:1235)
    at com.sun.enterprise.v3.admin.AdminAdapter.doCommand(AdminAdapter.java:465)
    at com.sun.enterprise.v3.admin.AdminAdapter.service(AdminAdapter.java:222)
    at com.sun.grizzly.tcp.http11.GrizzlyAdapter.service(GrizzlyAdapter.java:168)
    at com.sun.enterprise.v3.server.HK2Dispatcher.dispath(HK2Dispatcher.java:117)
    
    
soap-ui-exception-string index out of bound Test

  <faultcode>S:Server</faultcode>
         <faultstring>String index out of range: 0</faultstring>
         <detail>
            <ns2:exception class="java.lang.StringIndexOutOfBoundsException" note="To disable this feature, set com.sun.xml.ws.fault.SOAPFaultBuilder.disableCaptureStackTrace system property to false" xmlns:ns2="http://jax-ws.dev.java.net/">
               <message>String index out of range: 0</message>
               <ns2:stackTrace>
                  <ns2:frame class="java.lang.String" file="String.java" line="686" method="charAt"/>
                

Next

Downloaded xsd and wsdl from shared drive and studied it. (sampleSchema.xsd and account.wsdl) Generated java classes using xjc tool

    C:\Users\Desktop\WS-proj1>xjc -d src -p jaxbAccount WebContent\WEB-INF\wsdl\sampleSchema.xsd
    parsing a schema...
    compiling a schema...
    jaxbAccount\Account.java
    jaxbAccount\AccountDetailsResponse.java
    jaxbAccount\ObjectFactory.java
    jaxbAccount\RequestForAccountDetails.java
    jaxbAccount\package-info.java

Created AccountService.java (top to bottom approach)
    package service;
 
    import javax.jws.WebService;
    import javax.jws.soap.SOAPBinding;
    import javax.jws.soap.SOAPBinding.ParameterStyle;
 
    import jaxbAccount.Account;
    import jaxbAccount.AccountDetailsResponse;
    import jaxbAccount.RequestForAccountDetails;
 
    @WebService(
        serviceName="AccountService",
        portName="AccountServiceSOAP",
        targetNamespace="http://www.majrul.com/training/webservice/AccountService",
        wsdlLocation="AccountService.wsdl" // Metro will look into WEB_INF/wsdl folder by default
        )
    @SOAPBinding(parameterStyle=ParameterStyle.BARE) // required to be BARE or else will fail
    public class AccountService {
 
    public AccountDetailsResponse getDetails(RequestForAccountDetails request) {
        int accno = request.getAcno();
        // business logic to getch the details of given account
        // right now some static code
        AccountDetailsResponse response = new AccountDetailsResponse();
        Account account = new Account();
        account.setName("Tareque");
        account.setType("Savings");
        account.setBalance(1000);
         
        response.setAccount(account);
        return response;
         
    }
    }	

Then generated client proxy using wsimport and tested the same. Even with soap ui.

AccountClient
    package client_testers;
    import acc_service_client.Account;
    import acc_service_client.AccountDetailsResponse;
    import acc_service_client.AccountService;
    import acc_service_client.AccountServicePort;
    import acc_service_client.RequestForAccountDetails;
    public class AccountClient {
    public static void main(String[] args) {
         
        AccountService accserv = new AccountService();
        AccountServicePort proxy = accserv.getAccountServiceSOAP();
         
        RequestForAccountDetails request = new RequestForAccountDetails();
        request.setAcno(122);
         
        AccountDetailsResponse response = proxy.getDetails(request);
        Account acc = response.getAccount();
         
        System.out.println(acc.getName() + " " + acc.getType() + " " + acc.getBalance());
    }
    }

Error as unsupported parameterStyle was used (WRAPPED) where as BARE was needed.

   <faultcode>S:Server</faultcode>
         <faultstring>unexpected XML tag. expected: {http://www.majrul.com/training/webservice/AccountService}getDetails but found: {http://www.majrul.com/training}requestForAccountDetails</faultstring>
         <detail>
            <ns2:exception class="com.sun.xml.ws.streaming.XMLStreamReaderException" note="To disable this feature, set com.sun.xml.ws.fault.SOAPFaultBuilder.disableCaptureStackTrace system property to false" xmlns:ns2="http://jax-ws.dev.java.net/">
               <message>unexpected XML tag. expected: {http://www.majrul.com/training/webservice/AccountService}getDetails but found: {http://www.majrul.com/training}requestForAccountDetails</message>
               <ns2:stackTrace>
                  <ns2:frame class="com.sun.xml.ws.streaming.XMLStreamReaderUtil" file="XMLStreamReaderUtil.java" line="218" method="verifyTag"/>
                  <ns2:frame class="com.sun.xml.ws.streaming.XMLStreamReaderUtil" file="XMLStreamReaderUtil.java" line="226" method="verifyTag"/>
              

purchaseOrder.xsd : simple JAXB project
    package tester;
    import javax.xml.bind.JAXBContext;
    import javax.xml.bind.Marshaller;
    import purchaseOrder.PurchaseOrderType;
    import purchaseOrder.USAddress;
    public class TestJAXB {
    public static void main(String[] args) throws Exception {
         
        PurchaseOrderType po = new PurchaseOrderType();
        USAddress addr = new USAddress();
        addr.setState("NJ");
        po.setBillTo(addr);
        addr = new USAddress();
        addr.setState("NY");
        po.setShipTo(addr);
         
        JAXBContext jaxbContext = JAXBContext.newInstance(PurchaseOrderType.class);
        Marshaller marshaller = jaxbContext.createMarshaller();
        marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
        marshaller.marshal(po, System.out);
    }
    }
    // Output
    <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
    <purchaseOrderType>
    <shipTo>
        <state>NY</state>
    </shipTo>
    <billTo>
        <state>NJ</state>
    </billTo>
    </purchaseOrderType>


handler

    package handler;
    import java.util.Set;
    import javax.xml.namespace.QName;
    import javax.xml.soap.SOAPEnvelope;
    import javax.xml.soap.SOAPHeader;
    import javax.xml.soap.SOAPMessage;
    import javax.xml.ws.handler.MessageContext;
    import javax.xml.ws.handler.soap.SOAPHandler;
    import javax.xml.ws.handler.soap.SOAPMessageContext;
    public class MySOAPMessageHandler implements SOAPHandler<SOAPMessageContext>{
    // called for both incoming and outgoing, no separate config, need to write if-else
    @Override
    public boolean handleMessage(SOAPMessageContext context) {
         
        SOAPMessage msg = context.getMessage();
         
        try {
            SOAPEnvelope soapEnv = msg.getSOAPPart().getEnvelope();
            SOAPHeader soapHeader = soapEnv.getHeader();
            String content = msg.getSOAPBody().getTextContent();
            // whether incoming or outgoing message
            boolean isOutbound = (Boolean) context.get(MessageContext.MESSAGE_OUTBOUND_PROPERTY);
            if(isOutbound) {
                System.out.println("Outgoing message : response " + content);
            } else {
                System.out.println("Incoming message : request " + content);
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
         
        return true; // do you want to continue the execution chain, should be true mostly
    }
    @Override
    public boolean handleFault(SOAPMessageContext context) {
        return true;
    }
    @Override
    public void close(MessageContext context) {
    }
    @Override
    public Set<QName> getHeaders() {
        return null;
    }
    }

Add handlers.xml to same package as service class

    <?xml version="1.0" encoding="UTF-8"?>
    <handler-chains xmlns="http://java.sun.com/xml/ns/javaee">
        <handler-chain>
            <handler>
                <handler-class>handler.MySOAPMessageHandler</handler-class>
            </handler>
        </handler-chain>
    </handler-chains>

Add below attribute to any @WebService class as needed
    @HandlerChain(file="handlers.xml")
    
    

